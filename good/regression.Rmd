---
title: "Two examples of regression"
author: "CodeRep - Literate Programming Team"
date: "`r Sys.Date()`"
output:
  beamer_presentation:
    citation_package: natbib
  ioslides_presentation: default
bibliography: references.bib
---

# Introduction

## Outline

* Examples of two generalised linear models

  * Linear regression for blood pressure data

  * Binomial regression for breast cancer data





# Linear regression for blood pressure data

## First look at the data
```{r preamble, echo = FALSE}
knitr::opts_chunk$set(fig.align = "center", out.width = "80%")
```

```{r blood_data}
blood.dat <- read.csv("BloodPressure.csv")
head(blood.dat)
```

* `r nrow(blood.dat)` rows

* dots in names not highly recommended

## Change the names
```{r blood_rename}
blood_data <- blood.dat
names(blood_data) <- c("age", "blood_pressure")
tail(blood_data)
```

## Scatterplot
```{r blood_scatterplot}
plot(blood_data)
```

## Larger labels via chunk options
```{r blood_scatterplot_again, fig.width = 6.0, fig.height = 4.0}
plot(blood_data)
```

* Changing `par()` not recommended

## `ggplot2` for more flexible plotting
```{r ggplot2, fig.asp = 0.5}
library(ggplot2)
ggplot(blood_data) +
  geom_point(aes(age, blood_pressure)) +
  theme_bw(16) + # legible font size
  labs(x = "Age (year)", y = "Blood pressure (mmHg)")
```

## Linear regression

* Potential effect of age on blood pressure

```{r blood_regression}
lm_blood <-
  lm(blood_pressure ~ age, data = blood_data)
coeff_blood <- coefficients(lm_blood) # useful later
coeff_blood
```

* `summary(lm_obj_blood)` too large to show

* Of more interest is the fit

## Line of best fit
```{r blood_fitted_line, fig.width = 5.0, fig.height = 3.5}
plot(blood_data)
abline(a = coeff_blood[1], b = coeff_blood[2], col = 2)
```

## Diagnostics

* The command `plot(lm_blood)` gives 4 plots by default

* Not ideal for presentation

* Look up the help page of `plot.lm()` for details of each plot

* We shall look at one plot for now - the residuals against fitted values

## Residuals
```{r blood_residuals, fig.width = 5.0, fig.height = 3.5}
plot(lm_blood, which = 1)
```





# Binomial regression for breast cancer data

## Data source
```{r cancer, echo = FALSE}
library(survival)
```

* From @ra13

* `r nrow(rotterdam)` primary breast cancers patients whose records were included in the Rotterdam tumor bank

* Full data not shown because of large sample size and `r ncol(rotterdam)` variables

* Code below for illustration

```{r cancer_dummy, eval = FALSE}
library(survival}
rotterdam
```

## Data manipulation
```{r cancer_modify}
cancer_data <- rotterdam
cancer_data$death <-
  factor(
    rotterdam$death,
    levels = c(0, 1),
    labels = c("alive", "dead")
  )
```

* New data set to preserve `rotterdam`

* Label the factor variables to make them informative

## Piping operator
```{r cancer_pipe}
cancer_data$meno <- rotterdam$meno |>
  factor(
    levels = c(0, 1),
    labels = c("premenopausal", "postmenopausal")
  )
cancer_data$hormon <- rotterdam$hormon |>
  factor(
    levels = c(0, 1),
    labels = c("no", "yes")
  )
cancer_data$recur <- rotterdam$recur |>
  factor(
    levels = c(0, 1),
    labels = c("no relapse", "relapse")
  )
```

## Exploratory analysis
```{r cancer_meno_death}
table(cancer_data$meno, cancer_data$death)
```

* Contingency table of menopausal status and alive/dead

* Seeming effect, but potentially confounding with age

## Some more contingency tables
```{r cancer_contingencies}
table(cancer_data$hormon, cancer_data$death)
table(cancer_data$recur, cancer_data$death)
```

* Unclear effect of hormonal treatment on alive/dead

* Strong correlation between relapse and alive/dead

## Binomial regression

```{r cancer_glm_initial}
glm_cancer <-
  glm(
    death ~ . - pid - year,
    data = cancer_data,
    family = binomial
  )
```

* To examine the effect of variables on alive/dead

  * Linear regression not applicable for binary response

  * Binomial regression with logit link i.e. logistic regression

* Patient identifier and year of surgery excluded as they are unlikely to have an effect

## Stepwise selection
```{r cancer_glm_step}
step_cancer <- step(glm_cancer, trace = 0)
```

* A non-positive `trace` suppresses printing intermediate results

* AIC of `step_cancer`: `r round(AIC(step_cancer),2)`, smaller than  
AIC of `glm_cancer`: `r round(AIC(glm_cancer),2)`

* Variables not useful dropped, while fit improved

* Both `step_cancer` & `glm_cancer` are `glm` objects

  * Graphical and numerical comparison made easy
  
## Graphical comparison
```{r cancer_plots, out.width = "45%", fig.show = "hold", fig.width = 6.5, fig.height = 6.5}
plot(glm_cancer, which = 1)
plot(step_cancer, which = 1)
```

## Summary

* Two data sets analysed

* One regression model fitted to each